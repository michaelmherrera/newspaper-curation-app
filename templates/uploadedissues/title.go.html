{{block "content" .}}

{{if gt .Data.Title.TitleErrors 0}}
  <h2>Errors</h2>
  <div class="title-with-errors">
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <span>
      This title has errors which may prevent all issues from showing up, or
      which may be causing the title itself to fail.  It is strongly advised
      you not queue issues unless you understand the ramifications fully.
    </span>
  </div>
  <ul>
    {{range .Data.Title.Errors}}
    <li>{{.}}</li>
    {{end}}
  </ul>
{{end}}

<table class="table table-striped table-bordered table-condensed sortable">
  <caption><h2>Issues</h2></caption>
  <thead>
    <tr>
      <th scope="col" class="sort-alpha">Org. Code</th>
      <th scope="col" class="sort-alpha">Issue</th>
      <th scope="col" class="sort-alpha">Type</th>
      <th scope="col" class="sort-alpha">Last Modified</th>
      <th scope="col" class="sort-alpha">Issue Status</th>
      <th scope="col" class="sort-number">File Count</th>
      <th scope="col" class="sort-alpha">File Status</th>
    </tr>
  </thead>

  <tbody>
    {{range .Data.Title.Issues}}
      <tr>
        <td>{{.MARCOrgCode}}</td>
        <td>{{.Link}}</td>
        <td>{{.WorkflowStep}}</td>
        <td>{{TimeString .Modified}}</td>
        <td>
          {{- if gt (len .Errors) 0}}
            <div class="issue-error-list">
            Errors:
            <ul>
              {{range .Errors}}
              <li>{{.}}</li>
              {{end}}
            </ul>
          {{- end}}
          {{- if .IsNew}}
            <div class="issue-new">This issue was recently uploaded, and might get more changes</div>
          {{- end}}
        </td>
        <td>{{len .Files}}</td>
        <td>
          {{- if gt (len .Files) 0}}
            {{if gt .ChildErrors 0}}
              <b>{{.ChildErrors}} file error(s)</b>
            {{- else}}
              No file errors detected
            {{- end}}
          {{- else}}
            N/A
          {{- end}}
        </td>
      </tr>
    {{end}}
  </tbody>
</table>

<script>SortableTable.initAll()</script>
{{end}}
